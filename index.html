
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>双功能计算器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f2f2f2;
    }
    h1, h2 {
      text-align: center;
    }
    .section {
      display: none;
      background: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    button {
      padding: 8px 12px;
      margin: 5px;
      cursor: pointer;
    }
    select, input[type="number"] {
      padding: 4px;
      width: 80px;
    }
    .btn-group {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>双功能计算器</h1>
  <div class="btn-group">
    <button onclick="showSection('change')">算零钱</button>
    <button onclick="showSection('tips')">小费</button>
  </div>

  <!-- 算零钱 -->
  <div id="change" class="section">
    <h2>算零钱</h2>
    <table id="changeTable">
      <thead>
        <tr>
          <th>面值</th>
          <th>数量</th>
          <th>总金额</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2">总金额</td>
          <td id="changeTotal">0</td>
        </tr>
      </tfoot>
    </table>
    <button onclick="calculateChange()">计算</button>
  </div>

  <!-- 小费 -->
  <div id="tips" class="section">
    <h2>小费分配</h2>
    <div>
      小费总额: <input type="number" id="totalTips" value="0" oninput="calculateTips()">
    </div>
    <h3>第一部分: 12%</h3>
    <div>12%：<span id="tips12">0</span></div>

    <h3>第二部分: 26.4%</h3>
    <label>人数: 
      <select id="backNum" onchange="calculateTips()">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </label>
    <table id="backTable">
      <thead>
        <tr>
          <th>后厨</th>
          <th>金额</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>第三部分: 前厅61.6%</h3>
    上午金额: <input type="number" id="morningAmount" value="0" oninput="calculateTips()">
    <br><br>
    人数: 
    <select id="frontNum" onchange="calculateTips()">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
    <table id="frontTable">
      <thead>
        <tr>
          <th>前厅</th>
          <th>上午</th>
          <th>晚上</th>
          <th>比例</th>
          <th>金额</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const denominations = [100, 50, 20, 10, 5, 2, 1, 0.25, 0.1, 0.05];
    const changeTableBody = document.querySelector('#changeTable tbody');

    // 初始化零钱表格
    denominations.forEach(value => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${value}</td>
        <td><input type="number" value="0" min="0"></td>
        <td>0</td>
      `;
      changeTableBody.appendChild(row);
    });

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
    }

    function calculateChange() {
      let total = 0;
      changeTableBody.querySelectorAll('tr').forEach(row => {
        const value = parseFloat(row.children[0].textContent);
        const qty = parseFloat(row.children[1].children[0].value) || 0;
        const subtotal = value * qty;
        row.children[2].textContent = subtotal.toFixed(2);
        total += subtotal;
      });
      document.getElementById('changeTotal').textContent = total.toFixed(2);
    }

    function calculateTips() {
      const totalTips = parseFloat(document.getElementById('totalTips').value) || 0;
      const tips12 = totalTips * 0.12;
      document.getElementById('tips12').textContent = tips12.toFixed(3);

      const backNum = parseInt(document.getElementById('backNum').value);
      const backAmount = totalTips * 0.264 / backNum;
      const backTableBody = document.querySelector('#backTable tbody');
      backTableBody.innerHTML = '';
      for (let i = 1; i <= backNum; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `<td>后厨${i}</td><td>${backAmount.toFixed(3)}</td>`;
        backTableBody.appendChild(row);
      }

      const frontNum = parseInt(document.getElementById('frontNum').value);
      const morningAmount = parseFloat(document.getElementById('morningAmount').value) || 0;
      const frontTableBody = document.querySelector('#frontTable tbody');
      frontTableBody.innerHTML = '';

      const ratios = ["1/4","3/4","1/3","2/3","1/2"];
      for (let i = 0; i < frontNum; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${String.fromCharCode(65+i)}</td>
          <td><input type="checkbox" class="am"></td>
          <td><input type="checkbox" class="pm"></td>
          <td>
            <select class="ratio">
              ${ratios.map(r=>`<option value="${r}">${r}</option>`).join('')}
            </select>
          </td>
          <td class="amount">0</td>
        `;
        frontTableBody.appendChild(row);
      }

      function recalcFront() {
        const rows = frontTableBody.querySelectorAll('tr');
        const amChecked = [...rows].filter(r=>r.querySelector('.am').checked);
        const pmChecked = [...rows].filter(r=>r.querySelector('.pm').checked);

        rows.forEach(r => {
          let total = 0;
          if (r.querySelector('.am').checked && amChecked.length > 0) {
            total += (morningAmount * 0.616 / amChecked.length);
          }
          if (r.querySelector('.pm').checked) {
            const ratio = r.querySelector('.ratio').value;
            let [num,den] = ratio.split('/').map(Number);
            total += (totalTips - morningAmount) * 0.616 * (num/den);
          }
          r.querySelector('.amount').textContent = total.toFixed(3);
        });
      }
      frontTableBody.querySelectorAll('input, select').forEach(el=>{
        el.addEventListener('change', recalcFront);
      });
    }
  </script>
</body>
</html>
